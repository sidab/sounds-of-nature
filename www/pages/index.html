<template>
    <div class="page">

        <div class="fab fab-right-top sound-icons">

            <a class="sound" href="#">

                <i class="icon f7-icons">speaker_2</i>

            </a>

            <a class="mute display-none" href="#">

                <i class="icon f7-icons">speaker_slash</i>

            </a>

        </div>

        <div class="page-content">

            <div class="swiper-container categories">

                <div class="swiper-wrapper categories-inner">

                    {{#each categories}}

                        <div data-category="{{id}}" class="category swiper-slide">

                            <video class="video" autoplay muted loop playsinline>
                                <source src="{{video}}" type="video/mp4">
                            </video>

                            <div class="category-inner">

                                <div class="block-title block-title-large text-align-center">{{name}}</div>

                                <div class="margin-horizontal row items text-color-white">

                                    {{#each items}}

                                        <list-item name="{{name}}" audio="{{js "app.methods.getLink(this.audio)"}}" image="{{image}}"></list-item>

                                    {{/each}}

                                </div>

                                <div class="pagination text-align-center">

                                    <i class="icon f7-icons">

                                        {{#js_if "this.@index === 4"}}

                                            arrow_left

                                        {{else}}

                                            arrow_right

                                        {{/js_if}}

                                    </i>

                                </div>

                            </div>

                        </div>

                    {{/each}}

                </div>

            </div>

        </div>

    </div>

</template>

<style scoped>

    {{this}} {
        background-color: #000;
        background-size: cover;
        background-repeat: no-repeat;
    }

    {{this}}::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        background-color: #000;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: .3s;
    }

    {{this}} .fab, .fab a {
                 background: transparent;
                 box-shadow: none;
             }
    {{this}}.change::before {
                opacity: 1;
            }

    {{this}} .categories {

             }
    {{this}} .categories .categories-inner {

             }
    {{this}} .categories .categories-inner .category {
height: 100vh;
                 overflow: hidden;
             }
    {{this}} .categories .categories-inner .category .category-inner {
                 position: relative;
                 z-index: 99;
             }
    {{this}} .page-content {

    }

    {{this}} .video {
                 position: absolute;
                 height: 100%;
                 z-index: 9;
                 -webkit-filter: blur(5px);
                 -moz-filter: blur(5px);
                 -o-filter: blur(5px);
                 -ms-filter: blur(5px);
                 filter: blur(5px);
    }


    {{this}} .items {
        margin-top: 35px;
    }

    {{this}} .items .item {
                 background-repeat: no-repeat;
                 background-size: cover;
                 height: var(--f7-list-item-height);
                 border-radius: 5px;
                 position: relative;
        margin-bottom: 30px;
        transition: .3s;
                 border: 3px solid #eee;
                 overflow: hidden;
    }

    {{this}} .items .item .preloader-block {
                 line-height: calc(var(--f7-list-item-height) - 10px);
             }
    {{this}} .items .item .preloader {
        width: 30px;
        height: 30px
             }

    {{this}} .items .item.active {
                 border-color: orange;
                 color: orange !important;
             }

    {{this}} .items .item.active .range-slider {
                 opacity: 1;
                 visibility: visible;
             }
    {{this}} .items .item .range-slider {
                 position: absolute;
                 bottom: 0px;
                 --f7-range-bar-size: 5px;
                 opacity: 0;
        transition: .3s;
                 visibility: hidden;
        width: 90%;
             }

    {{this}} .items .item .range-slider-out {
                 width: 90%;
                 margin: 0 auto;
             }
    {{this}} .items .item .icon {
                 transition: .3s;
                 position: absolute;
                 font-size: 40px;
                 width: 100%;
                 height: 100%;
                 top: calc(50% - 20px);
             }

    {{this}} .items .item .play {
                 opacity: 1;
             }

    {{this}} .items .item .pause {
                 opacity: 0;
             }

    {{this}} .items .item.active .play {
                 opacity: 0;
             }

    {{this}} .items .item.active .pause {
                 opacity: 1;
             }
    {{this}} .items .item .title {
                 bottom: -40px;
                 position: absolute;
                 font-size: 23px;
                 font-weight: bold;
                 width: 100%;
                 text-align: center;
                 text-transform: lowercase;
    }

</style>

<script>

    return {

        data: function () {

            return {
                categories: [

                    {
                        id: 'nature',
                        name: app.methods.lang('nature'),
                        video: 'video/nature.mp4',
                        items: [

                            {
                                name: app.methods.lang('nature') + '1',
                                image: 'images/nature/1.jpg',
                                audio: 'audio/nature/1.mp3'
                            },
                            {
                                name: app.methods.lang('nature') + '2',
                                image: 'images/nature/2.jpg',
                                audio: 'audio/nature/2.mp3'
                            },
                            {
                                name: app.methods.lang('nature') + '3',
                                image: 'images/nature/3.jpg',
                                audio: 'audio/nature/3.mp3'
                            },
                            {
                                name: app.methods.lang('nature') + '4',
                                image: 'images/nature/4.jpg',
                                audio: 'audio/nature/4.mp3'
                            },
                            {
                                name: app.methods.lang('nature') + '5',
                                image: 'images/nature/5.jpg',
                                audio: 'audio/nature/5.mp3'
                            },
                            {
                                name: app.methods.lang('nature') + '6',
                                image: 'images/nature/6.jpg',
                                audio: 'audio/nature/6.mp3'
                            }
                        ]
                    },
                    {
                        id: 'bonfire',
                        name: app.methods.lang('bonfire'),
                        video: 'video/bonfire.mp4',
                        items: [

                            {
                                name: app.methods.lang('bonfire') + '1',
                                image: 'images/bonfire/1.jpg',
                                audio: 'audio/bonfire/1.mp3'
                            },
                            {
                                name: app.methods.lang('bonfire') + '2',
                                image: 'images/bonfire/2.jpg',
                                audio: 'audio/bonfire/2.mp3'
                            },
                            {
                                name: app.methods.lang('bonfire') + '3',
                                image: 'images/bonfire/3.jpg',
                                audio: 'audio/bonfire/3.mp3'
                            },
                            {
                                name: app.methods.lang('bonfire') + '4',
                                image: 'images/bonfire/4.jpg',
                                audio: 'audio/bonfire/4.mp3'
                            }
                        ]
                    },
                    {
                        id: 'rain',
                        name: app.methods.lang('rain'),
                        video: 'video/rain.mp4',
                        items: [

                            {
                                name: app.methods.lang('rain') + '1',
                                image: 'images/rain/1.jpg',
                                audio: 'audio/rain/1.mp3'
                            },
                            {
                                name: app.methods.lang('rain') + '1',
                                image: 'images/rain/2.jpg',
                                audio: 'audio/rain/2.mp3'
                            },
                            {
                                name: app.methods.lang('rain') + '1',
                                image: 'images/rain/3.jpg',
                                audio: 'audio/rain/3.mp3'
                            },
                            {
                                name: app.methods.lang('rain') + '1',
                                image: 'images/rain/4.jpg',
                                audio: 'audio/rain/4.mp3'
                            },
                        ]
                    },
                    {
                        id: 'sea',
                        name: app.methods.lang('sea'),
                        video: 'video/sea.mp4',
                        items: [

                            {
                                name: app.methods.lang('sea') + '1',
                                image: 'images/sea/1.jpg',
                                audio: 'audio/sea/1.mp3'
                            },
                            {
                                name: app.methods.lang('sea') + '2',
                                image: 'images/sea/2.jpg',
                                audio: 'audio/sea/2.mp3'
                            },
                            {
                                name: app.methods.lang('sea') + '3',
                                image: 'images/sea/3.jpg',
                                audio: 'audio/sea/3.mp3'
                            },
                            {
                                name: app.methods.lang('sea') + '4',
                                image: 'images/sea/4.jpg',
                                audio: 'audio/sea/4.mp3'
                            },
                            {
                                name: app.methods.lang('sea') + '5',
                                image: 'images/sea/5.jpg',
                                audio: 'audio/sea/5.mp3'
                            },
                            {
                                name: app.methods.lang('sea') + '6',
                                image: 'images/sea/6.jpg',
                                audio: 'audio/sea/6.mp3'
                            }
                        ]
                    },
                    {
                        id: 'train',
                        name: app.methods.lang('train'),
                        video: 'video/train.mp4',
                        items: [

                            {
                                name: app.methods.lang('train') + '1',
                                image: 'images/train/1.jpg',
                                audio: 'audio/train/1.mp3'
                            },
                            {
                                name: app.methods.lang('train') + '2',
                                image: 'images/train/2.jpg',
                                audio: 'audio/train/2.mp3'
                            },
                            {
                                name: app.methods.lang('train') + '3',
                                image: 'images/train/3.jpg',
                                audio: 'audio/train/3.mp3'
                            },
                            {
                                name: app.methods.lang('train') + '4',
                                image: 'images/train/4.jpg',
                                audio: 'audio/train/4.mp3'
                            },
                        ]
                    }
                ]
            }

        },
        methods: {
            update: function () {

                var component = this;
                var app = component.$app;
                var page = component.$el;

                component.categories = component.$options.data().categories;

                component.$update();

            }
        },
        on: {

            pageBeforeIn: function () {

                var component = this;
                var app = component.$app;
                var page = component.$el;

                if (localStorage.language == undefined) {

                    var chooseLanguage = app.dialog.create({
                        text: 'Choose Language',
                        buttons: [
                            {
                                text: 'Русский',
                                onClick: function () {

                                    localStorage.language = 'russian';

                                    app.params.language = 'russian';

                                    component.update();

                                }
                            },
                            {
                                text: 'العربية',
                                onClick: function () {

                                    localStorage.language = 'arabian';

                                    app.params.language = 'arabian';

                                    component.update();;

                                }
                            },
                            {
                                text: 'English',
                                onClick: function () {

                                    localStorage.language = 'english';

                                    app.params.language = 'english';

                                    component.update();

                                }
                            },
                        ],
                        verticalButtons: true
                    }).open();

                }

            },
            pageInit: function() {

                var component = this;
                var app = component.$app;
                var page = component.$el;

                var categoriesSwiper = new Swiper('.swiper-container', {
                    slidesPerView: 1,
                    spaceBetween: 0,
                    //setWrapperSize: true,
                    cssMode: true,
                    //simulateTouch: false,
                    //speed: 300
                });

                page.find('.video').each(function () {

                    $$(this).on('loadeddata', function () {
                        $$(this)[0].muted = true;
                        $$(this)[0].play();
                    });

                });

                page.find('.sound-icons').find('a').on('click', function () {

                    if ($$(this).hasClass('mute')) {

                        Howler.mute(false);

                        page.find('.sound-icons').find('.sound').removeClass('display-none');

                        page.find('.sound-icons').find('.mute').addClass('display-none');

                    } else {

                        Howler.mute(true);

                        page.find('.sound-icons').find('.sound').addClass('display-none');

                        page.find('.sound-icons').find('.mute').removeClass('display-none');

                    }

                });

                page.find('.item').on('click', function (event) {

                    if ($$(event.target).attr('class').indexOf('range') !== -1) {

                        return false;

                    }

                    var item = $$(this);
                    var image = item.data('image');
                    var name = item.data('name');
                    var audio = item.data('audio');
                    var isActive = item.hasClass('active');

                    if (isActive) {

                        $$(this).removeClass('active');

                        component[audio].pause();

                        return false;

                    }

                    if (component[audio] == undefined) {

                        item.find('.preloader-block').removeClass('display-none');
                        item.find('.pause').addClass('display-none');

                        component[audio] = new Howl({
                            src: audio,
                            loop: true,
                            html5: true,
                            preload: false,
                            //usingWebAudio: false,
                            //webAudio: false,
                            volume: 1,
                            onplay: function () {

                                item.find('.preloader-block').addClass('display-none');
                                item.find('.pause').removeClass('display-none');

                            }
                        });

                        setInterval(function () {

                            if (component[audio].playing()) {

                                cordova.plugins.backgroundMode.enable();

                            } else {

                                cordova.plugins.backgroundMode.disable();

                            }

                        }, 10000);

                    }

                    component[audio].play();

                    $$(this).addClass('active');

                });

                page.find('.range-slider').on('range:change', function () {

                    var range = app.range.get($$(this));
                    var audio = $$(this).parents('.item').data('audio');

                    if (component[audio] !== undefined) {

                        component[audio].volume(range.value);

                    }

                });

            },
            pageAfterIn: function () {

                var component = this;
                var app = component.$app;
                var page = component.$el;


            }

        }

    }

</script>